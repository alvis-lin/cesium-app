<DOCTYPE html>
  <html lang="en">
  <head>
    <!-- Use correct character set. -->
    <meta charset="utf-8">

    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


    <!-- custom fonts and styles for the bootstrap template -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" type="text/css" rel="stylesheet"> 
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"  crossorigin="anonymous">

    <link href="css/sb-admin-2.css" type="text/css" rel="stylesheet">


    <!-- cesium -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.70/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.70/Build/Cesium/Widgets/widgets.css" rel="stylesheet">





    <!-- js functionality to get ports -->
    <script src="js/utilities.js"></script> 

    <!-- js to check and upload form --> 
    <script src="js/cesiumCheckForm.js"></script>

    <!-- js to track latlng clicks --> 
    <script src="js/getLatlng.js"></script>





    <title>Editing in 3D</title>
    <!-- adapted from: https://blackrockdigital.github.io/startbootstrap-sb-admin-2/ -->


    <!-- <style>
        @import url(https://cesium.com/downloads/cesiumjs/releases/1.70/Build/Cesium/Widgets/widgets.css);
        html, body, #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        .toolbar-left {
            display: block;
            position: absolute;
            top: 20px;
            left: 250px;
        }

        .toolbar-left-bottom {
            display: block;
            position: absolute;
            top: 80px;
            left: 250px;
        }

        
        /*code to set control panel*/
        #controlPanel {
          position: absolute;
          top: 80px;
          left: 250px;
          background: rgba(42, 42, 42, 0.8);
          padding: 20px;
          border-radius: 10px;
          color: white;
        }
        label {
          cursor: pointer;
        }
        label:hover span {
          text-decoration: underline;
        }

    </style> -->

  </head>
  <body id="page-top">
    <div id="wrapper">

      <!-- Sidebar -->
      <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center justify-content-center" >
          <div class="sidebar-brand-text mx-3" style="color: white; text-align: center">Web 3D GIS</div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider">
        <div class="sidebar-brand-text mx-5" style="color: white">Working Layer:</div>
        <div id="working_layer" style="color: white; text-align: center"></div>
        <br>
        <hr class="sidebar-divider">

        <!-- Nav Item - Pages Collapse Menu -->
        <!-- Nav Item - Pages Collapse Menu -->
        <!-- Adapted code for scrollable div from: https://stackoverflow.com/questions/10309268/set-div-height-auto-and-scroll-can-be-used -->

        <!-- hold form to set up quiz questions and only show on big screen (question)-->
        <!-- Adapted code for creating form: https://www.w3schools.com/tags/att_input_required.asp -->

        <!-- Create Point -->
        <!-- <li class="nav-item d-none d-lg-block" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne"> -->
            <!-- the next line is the cog image -->
            <!-- <i class="fas fa-fw fa-cog"></i>
            <span>Create Point</span>
          </a>
          <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionSidebar" style='max-height:50%; overflow-x:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded"> -->
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <!-- <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="model_name" class="control-label">Point Name</label><br>
                  <input type="text" size="20" class="form-control" id="model_name" placeholder="e.g. Pokemon Centre" required>
                </div>

                <div class="form-group">
                  <label for="latitude" class="control-label">Latitude</label><br>
                  <input type="text" size="20" id="latitude"/><br /> 
                  <label for="longitude" class="control-label">Longitude</label><br>
                  <input type="text" size="20" id="longitude"/><br />
                  <label for="altitude" class="control-label">Altitude</label><br>
                  <input type="text" size="20" id="altitude"/><br />
                  <div class="help-block with-errors">Please click on the map to get coordinates and height</div> 
                </div>

                <div class="form-group">
                  <button id="startPointUpload" type="button" class="btn btn-primary" onclick="submitPointClick()">Submit</button><br>
                  <div id="pointDataUploadResult">The result of the upload goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li> -->

        <!-- Create Line -->
        <!-- <li class="nav-item d-none d-lg-block" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseSix" aria-expanded="true" aria-controls="collapseSix"> -->
            <!-- the next line is the cog image -->
            <!-- <i class="fas fa-fw fa-cog"></i>
            <span>Create Line</span>
          </a>
          <div id="collapseSix" class="collapse" aria-labelledby="headingSix" data-parent="#accordionSidebar" style='max-height:50%; overflow-x:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded"> -->
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <!-- <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="line_name" class="control-label">Line Name</label><br>
                  <input type="text" size="20" class="form-control" id="line_name" placeholder="e.g. Route 1" required>
                </div>

                <div class="form-group">
                  <label for="linestring_coords" class="control-label">Linestring coordinates</label><br>
                  <input type="text" size="20" id="linestring_coords"/><br /> 
                  <div class="help-block with-errors">Please click on the map to get coordinates and height</div> 
                </div>

                <div class="form-group">
                  <button id="clearLineCoordsInput" type="button" class="btn btn-primary" onclick="clearLineCoords()">Clear input field</button>
                  <button id="startLineUpload" type="button" class="btn btn-primary" onclick="submitLineClick()">Submit</button><br>
                  <div id="lineDataUploadResult">The result of the line upload goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li> -->

        <!-- Create Polygon -->
        <!-- <li class="nav-item d-none d-lg-block" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseSeven" aria-expanded="true" aria-controls="collapseSeven"> -->
            <!-- the next line is the cog image -->
            <!-- <i class="fas fa-fw fa-cog"></i>
            <span>Create Polygon</span>
          </a>
          <div id="collapseSeven" class="collapse" aria-labelledby="headingSeven" data-parent="#accordionSidebar" style='max-height:50%; overflow-x:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded"> -->
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <!-- <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="polygon_name" class="control-label">Polygon Name</label><br>
                  <input type="text" size="20" class="form-control" id="polygon_name" placeholder="e.g. Pokemon School" required>
                </div>

                <div class="form-group">
                  <label for="polygon_coords" class="control-label">Polygon Coordinates</label><br>
                  <input type="text" size="20" id="polygon_coords"/><br /> 
                  <div class="help-block with-errors">Please click on the map to get coordinates and height</div> 
                </div>

                <div class="form-group">
                  <label for="polygon_height" class="control-label">Polygon Height</label><br>
                  <input type="text" size="20" class="form-control" id="polygon_height" placeholder="e.g. 1.234" required>
                </div>

                <div class="form-group">
                  <button id="clearPolygonCoordsInput" type="button" class="btn btn-primary" onclick="clearPolygonCoords()">Clear input field</button>
                  <button id="startPolygonUpload" type="button" class="btn btn-primary" onclick="submitPolygonClick()">Submit</button><br>
                  <div id="polygonDataUploadResult">The result of the polygon upload goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li> -->

     

        <!-- Create model -->
        <li class="nav-item">
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            <i class="far fa-plus-square"></i>
            <span>Create Model</span>
          </a>
          <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionSidebar" style='max-height:50%; overflow-y:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded">
              
              <!-- Tab links -->
              <div class="tab">
                <button class="tablinks" onclick="openGeom(event, 'Point')" id="defaultOpen">Point</button>
                <button class="tablinks" onclick="openGeom(event, 'Line')">Line</button>
                <button class="tablinks" onclick="openGeom(event, 'Polygon')">Polygon</button>
              </div>

              <!-- Create Point -->
              <div id="Point" class="tabcontent">
                <div class="bg-white py-2 collapse-inner rounded">
                  <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
                  <form name="questionForm" data-toggle="validator" role="form">
                    <div class="form-group">
                      <label for="model_name" class="control-label">Point Name</label>
                      <input type="text" size="20" class="form-control" id="point_name" placeholder="e.g. Pokemon Centre" required>
                    </div>

                    <div class="form-group">
                      <label for="latitude" class="control-label">Latitude</label>
                      <input type="text" size="20" class="form-control" id="latitude"/><br> 
                      <label for="longitude" class="control-label">Longitude</label>
                      <input type="text" size="20" class="form-control" id="longitude"/><br>
                      <label for="altitude" class="control-label">Altitude</label>
                      <input type="text" size="20" class="form-control" id="altitude"/>
                      <div class="help-block with-errors">Please click on the map to get coordinates</div> 
                    </div>

                    <div class="form-group">
                      <button id="startPointUpload" type="button" class="btn btn-primary" onclick="submitPointClick()">Submit</button><br>
                      <div id="pointDataUploadResult">The result goes here</div>   
                    </div>
                  </form>
                </div>
              </div>

              <!-- Create Line -->
              <div id="Line" class="tabcontent">
                <div class="bg-white py-2 collapse-inner rounded">
                  <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
                  <form name="questionForm" data-toggle="validator" role="form">
                    <div class="form-group">
                      <label for="line_name" class="control-label">Line Name</label>
                      <input type="text" size="20" class="form-control" id="line_name" placeholder="e.g. Route 1" required>
                    </div>

                    <div class="form-group">
                      <label for="linestring_coords" class="control-label">Line Coordinates</label>
                      <!-- <input type="text" size="20" class="form-control" id="linestring_coords"/> -->

                      <textarea type="text" cols="16" oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"' id="linestring_coords"></textarea><br />

                      <div class="help-block with-errors">Please click on the map to get coordinates</div>
                      <button id="clearLineCoordsInput" type="button" class="btn btn-primary" onclick="clearLineCoords()">Clear</button> 
                    </div>

                    <div class="form-group"> 
                      <button id="startLineUpload" type="button" class="btn btn-primary" onclick="submitLineClick()">Submit</button><br>
                      <div id="lineDataUploadResult">The result goes here</div>   
                    </div>
                  </form>
                </div>
              </div>

              <!-- Create Polygon -->
              <div id="Polygon" class="tabcontent">
                <div class="bg-white py-2 collapse-inner rounded">
                  <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
                  <form name="questionForm" data-toggle="validator" role="form">
                    <div class="form-group">
                      <label for="polygon_name" class="control-label">Polygon Name</label>
                      <input type="text" size="20" class="form-control" id="polygon_name" placeholder="e.g. Pokemon School" required>
                    </div>

                    <div class="form-group">
                      <label for="polygon_coords" class="control-label">Polygon Coordinates</label>
                      <textarea type="text" cols="16" oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"' id="polygon_coords"></textarea><br />



                      <div class="help-block with-errors">Please click on the map to get coordinates</div> 
                      <button id="clearPolygonCoordsInput" type="button" class="btn btn-primary" onclick="clearPolygonCoords()">Clear</button>
                    </div>

                    <!-- <div class="form-group">
                      <label for="polygon_height" class="control-label">Polygon Height</label><br>
                      <input type="text" size="20" class="form-control" id="polygon_height" placeholder="e.g. 1.234" required>
                    </div> -->

                    <div class="form-group">    
                      <button id="startPolygonUpload" type="button" class="btn btn-primary" onclick="submitPolygonClick()">Submit</button><br>
                      <div id="polygonDataUploadResult">The result goes here</div>   
                    </div>
                  </form>
                </div>
              </div>
           </div> <!-- end of collapse five -->
        </li> <!-- end of create geometry -->

        <!-- Delete Model -->
        <li class="nav-item" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
            <i class="fas fa-trash-alt"></i>
            <span>Delete Model</span>
          </a>
          <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar" style='max-height:50%; overflow-y:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded" style="padding: 5px 5px;">
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="deleteID" class="control-label">Model ID</label><br>
                  <input type="text" size="20" class="form-control" id="delete_id" placeholder="e.g.722" required>
                </div>
                <div class="form-group">
                  <button id="startDelete" type="button" class="btn btn-primary" onclick="deleteModel()">Delete</button><br>
                  <div id="dataDeleteResult">The result goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li>








        <!-- <li class="nav-item d-none d-lg-block" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree"> -->
            <!-- the next line is the cog image -->
            <!-- <i class="fas fa-fw fa-cog"></i>
            <span>EDIT Point Location</span>
          </a>
          <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionSidebar" style='max-height:50%; overflow-y:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded"> -->
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <!-- <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="model_name" class="control-label">Model ID</label><br>
                  <input type="text" size="20" class="form-control" id="model_id" placeholder="e.g.722" required>
                </div>

                <div class="form-group">
                  <label for="latitude" class="control-label">New Latitude</label><br>
                  <input type="text" size="20" id="latitude_edit"/><br /> 
                  <label for="longitude" class="control-label">New Longitude</label><br>
                  <input type="text" size="20" id="longitude_edit"/><br />
                  <label for="altitude" class="control-label">New Altitude</label><br>
                  <input type="text" size="20" id="altitude_edit"/><br />
                  <div class="help-block with-errors">Please click on the map to get coordinates and height</div>
                </div>
                <div class="form-group">
                  <button id="editBtn" type="button" class="btn btn-primary" onclick="submitEditClick()">Edit Model</button><br>
                  <div id="dataEditResult">The result of the edit goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li> -->

        <!-- Move Model -->
        <li class="nav-item" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseFour" aria-expanded="true" aria-controls="collapseFour">
            <i class="fas fa-arrows-alt"></i>
            <span>Move Model</span>
          </a>
          <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordionSidebar" style='max-height:50%; overflow-y:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded" style="padding: 5px 5px;">
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="model_name" class="control-label">Model ID</label><br>
                  <input type="text" size="20" class="form-control" id="move_model_id" placeholder="e.g. 722" required>
                </div>

                <div class="form-group">
                  <label for="move_y" class="control-label">Move Latidute (Degree)</label><br>
                  <input type="text" size="20" class="form-control" id="move_y"/><br /> 
                  <label for="move_x" class="control-label">Move Longitude (Degree)</label><br>
                  <input type="text" size="20" class="form-control" id="move_x"/><br />
                  <label for="move_z" class="control-label">Move Altitude (Metre)</label><br>
                  <input type="text" size="20" class="form-control" id="move_z"/><br />
        

                <div class="form-group">
                  <button id="editBtn" type="button" class="btn btn-primary" onclick="submitMoveClick()">Move Model</button><br>
                  <div id="dataMoveResult">The result goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li>


        <!-- Edit Model -->
        <li class="nav-item" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseEleven" aria-expanded="true" aria-controls="collapseEleven">
            <i class="fas fa-edit"></i>
            <span>Edit Model</span>
          </a>
          <div id="collapseEleven" class="collapse" aria-labelledby="headingEleven" data-parent="#accordionSidebar" style='max-height:50%; overflow-y:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded" style="padding: 5px 5px;">
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="model_name" class="control-label">Model ID</label><br>
                  <input type="text" size="20" class="form-control" id="edit_model_id" placeholder="e.g. 722" required><br>
                  <button id="getGeomBtn" type="button" class="btn btn-primary" onclick="getGeom()">Get Geometry</button><br><br>
                </div>

                <div class="form-group">
                  <label for="edit_geomcolumn" class="control-label">Edit geometry</label><br>
                  <textarea type="text" cols="17" rows="6" oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"' id="edit_geomcolumn"/></textarea><br><br> 

                <div class="form-group">
                  
                  <button id="editGeomBtn" type="button" class="btn btn-primary" onclick="submitEditClick()">Save Model</button><br>
                  <div id="dataEditResult">The result goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li>





        <!-- Extrude Model -->
        <li class="nav-item" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseEight" aria-expanded="true" aria-controls="collapseEight">
            <i class="fas fa-long-arrow-alt-up"></i>
            <span>Extrude Model</span>
          </a>
          <div id="collapseEight" class="collapse" aria-labelledby="headingEight" data-parent="#accordionSidebar" style='max-height:50%; overflow-y:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded" style="padding: 5px 5px;">
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="model_name" class="control-label">Model ID</label><br>
                  <input type="text" size="20" class="form-control" id="extrude_model_id" placeholder="e.g. 722" required>
                </div>

                <div class="form-group">
                  <label for="extrude_height" class="control-label">Extrude Height (Metre)</label><br>
                  <input type="text" size="20" class="form-control" id="extrude_height"/><br /> 
        

                <div class="form-group">
                  <button id="extrudeBtn" type="button" class="btn btn-primary" onclick="submitExtrudeClick()">Extrude Model</button><br>
                  <div id="dataExtrudeResult">The result goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li>


        <!-- Edit Model Height-->
        <li class="nav-item" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTen" aria-expanded="true" aria-controls="collapseTen">
            <i class="fas fa-arrows-alt-v"></i>
            <span>Edit Height</span>
          </a>
          <div id="collapseTen" class="collapse" aria-labelledby="headingTen" data-parent="#accordionSidebar" style='max-height:50%; overflow-y:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded" style="padding: 5px 5px;">
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="model_name" class="control-label">Model ID</label><br>
                  <input type="text" size="20" class="form-control" id="edit_height_model_id" placeholder="e.g. 722" required>
                </div>

                <div class="form-group">
                  <label for="extrude_height" class="control-label">New Height (Metre)</label><br>
                  <input type="text" size="20" class="form-control" id="extrude_height_edit"/><br /> 
        

                <div class="form-group">
                  <button id="editHeightBtn" type="button" class="btn btn-primary" onclick="submitEditHeightClick()">Edit Height</button><br>
                  <div id="dataEditHeightResult">The result goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li>



        <!-- Rotate Model -->
        <li class="nav-item" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseNine" aria-expanded="true" aria-controls="collapseNine">
            <i class="fas fa-redo"></i>
            <span>Rotate Model</span>
          </a>
          <div id="collapseNine" class="collapse" aria-labelledby="headingNine" data-parent="#accordionSidebar" style='max-height:30%; overflow-y:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded" style="padding: 5px 5px;">
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="model_name" class="control-label">Model ID</label><br>
                  <input type="text" size="20" class="form-control" id="rotate_model_id" placeholder="e.g. 722" required>
                </div>

                <div class="form-group">
                  <label for="rotate_degree" class="control-label">Rotation Degree <br>(90 = 90° <i class="fas fa-redo"></i><br>  -90 = 90° <i class="fas fa-undo"></i>)</label><br>
                  <input type="text" size="20" class="form-control" id="rotate_degree"/><br /> 
        

                <div class="form-group">
                  <button id="rotateBtn" type="button" class="btn btn-primary" onclick="submitRotateClick()">Rotate Model</button><br>
                  <div id="dataRotateResult">The result goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li>



        <!-- Buffering -->
        <li class="nav-item" >
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
            <i class="fas fa-record-vinyl"></i>
            <span>Buffering</span>
          </a>
          <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionSidebar" style='max-height:30%; overflow-y:scroll;'>
            <div class="bg-white py-2 collapse-inner rounded" style="padding: 5px 5px;">
              <!-- Adapted code for form https://1000hz.github.io/bootstrap-validator/ -->
              <form name="questionForm" data-toggle="validator" role="form">
                <div class="form-group">
                  <label for="model_name" class="control-label">Model ID</label><br>
                  <input type="text" size="20" class="form-control" id="buffer_model_id" placeholder="e.g. 722" required>
                </div>

                <div class="form-group">
                  <label for="rotate_degree" class="control-label">Radius (Metre)</label><br>
                  <input type="text" size="20" class="form-control" id="buffer_radius"/><br /> 
        

                <div class="form-group">
                  <button id="rotateBtn" type="button" class="btn btn-primary" onclick="submitBufferClick()">Generate Buffer</button><br>
                  <div id="dataRotateResult">The result goes here</div>   
                </div>

                <div class="form-group">
                  <button id="rotateBtn" type="button" class="btn btn-primary" onclick="deleteBufferClick()">Delete Buffer</button><br>
                  <div id="dataRotateResult">The result goes here</div>   
                </div>
              </form>
            </div>
          </div>
        </li>






<!-- 
        
        <hr>

        <button id="trackBtn" type="button" class="btn btn-primary" onclick="showCoords()">Show coords</button>
        <button id="refreshModel" type="button" class="btn btn-primary" onclick="refreshModel()">Refresh Models</button>
        <button id="removeModels" type="button" class="btn btn-primary" onclick="removeModels()">Remove Models</button>
 -->

       </ul>
       <!-- End of Sidebar -->

       <div id="content-wrapper" class="d-flex flex-column">
        <!-- cesium div -->
        <!-- <div id="cesiumContainer"></div> -->
        <div id="cesiumContainer" style="height: :50%"></div>
        <div class="toolbar-left">
          <button onclick="getOSModel();">OS Models</button>
          <button onclick="refresh84Model();">WGS84 Models</button>
          <button onclick="refresh84ModelBuffer();">WGS 84 Buffer</button>
          <button onclick="refreshGBModel();">National Grid Models</button>
          <button onclick="refreshGBModelBuffer();">National Grid Buffer Models</button>
          <button onclick="removeModels();">Remove Models</button>
        </div>

        <!-- CODE TO ADD TWO LAYERS -->
        <div class="toolbar-left-bottom" id="toolbar"></div>

        <!-- ControlPanel -->
        <!-- Adapt from: https://stackoverflow.com/questions/24206285/html5-cesium-making-divs-float-over-cesium-map [Accessed on 12 August, 2020] -->
        <div id="controlPanel">
          <i class="fas fa-layer-group"></i>
          <b>Control Panel</b><br/>
          Tick the box to toggle different layers<br/>
          <p>
            <hr color="white">
            <label>
              <input id="Checkbox_model" type="checkbox" />
              <span>Model Layer</span>
            </label><br/>
            
            <label>
              <input id="Checkbox_OS" type="checkbox" />
              <span>OS Layer</span>
            </label><br>

            <label>
              <input id="Checkbox_model_buffer" type="checkbox" />
              <span>Model Buffer Layer</span>
            </label><br/>

            <!-- <button class="cesium-button">Button 1</button>
            <button class="cesium-button">Button 2</button> -->
          </p>
        </div>




      </div>
      <!-- End of Main Content -->
    </div>
    <!-- end of wrapper -->

  </body>
  <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>  


  <!-- Bootstrap core JavaScript-->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="js/sb-admin-2.js"></script>



<script>
    
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzMjhmNWJlYy05OGM4LTQ2MTgtOTFlZC1mZTE0YmEzNDNhZmMiLCJpZCI6Mjc2MDgsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1ODk4MDk2NDV9.lPVb7dzHnqA6dSc14wNlbNTiiwNecYhMRdXub1delsk';


    // a new viewer for presenting 3D data
    var viewer = new Cesium.Viewer('cesiumContainer', {
        sceneMode : Cesium.SceneMode.SCENE3D,
        timeline : false,
        animation : false,
        selectionIndicator : false, // test picking
        // infoBox : false // test picking
    });

    // Adapt from: https://groups.google.com/forum/#!topic/cesium-dev/sfm049HSQgk [Accessed on: 22 July, 2020]
    // Adapt from: https://cesium.com/docs/cesiumjs-ref-doc/Cesium3DTileFeature.html [Accessed on 27 July, 2020]
    var scene = viewer.scene;
    var handler;
    handler = new Cesium.ScreenSpaceEventHandler(scene.canvas);
    handler.setInputAction(function(click) {
        var pickedObject = scene.pick(click.position);
        if (Cesium.defined(pickedObject)) {        
            // insert model_id of selected entity into form
            document.getElementById("delete_id").value = pickedObject.id._properties._model_id._value;
            document.getElementById("move_model_id").value = pickedObject.id._properties._model_id._value;
            document.getElementById("edit_model_id").value = pickedObject.id._properties._model_id._value;
            document.getElementById("extrude_model_id").value = pickedObject.id._properties._model_id._value;
            document.getElementById("edit_height_model_id").value = pickedObject.id._properties._model_id._value;
            document.getElementById("rotate_model_id").value = pickedObject.id._properties._model_id._value; 
            document.getElementById("buffer_model_id").value = pickedObject.id._properties._model_id._value;   
        }
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
    // }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK); // can also set the action as double click

    // TEST CODE TO ADD TOOLBAR
    // var skyAtmosphere = viewer.scene.skyAtmosphere;
    // var skyCheckbox = document.getElementById('showCheckbox');

    // skyCheckbox.addEventListener('change', function() {
    //   viewer.scene.skyAtmosphere = skyCheckbox.checked ? skyAtmosphere : undefined;
    // }, false);


    // var dataSource = Cesium.GeoJsonDataSource.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/30281');
    // viewer.dataSources.add(dataSource);
    // viewer.zoomTo(dataSource);



    // Test code to load multipolygon geojson file and plot on the map
    // From: https://gis.stackexchange.com/questions/271269/union-merge-3d-polygons-polyhedralsurface-z-each-with-different-heights-to-out
    // var dataSource1 = Cesium.GeoJsonDataSource.load('../new.geojson').then(
    //   function(dataSource1) {
    //     viewer.dataSources.add(dataSource1);
    //     viewer.zoomTo(dataSource1);
    //   }
    // );




    // to refresh layers when ever there is a change
    function refreshModel() {
      // reload data to update
      dataSource7.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/models/geom/4326');
      dataSource8.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/buildings_tq2580/geom/4326');
      dataSource9.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/models/buffer/4326');
      // removeModels();
      // refresh84Model();
      // refresh84ModelBuffer();
      // refreshGBModel();
      // refreshGBModelBuffer();
    }


    // TEST CODE!!!
    // function refresh84Model() {
    //   viewer.dataSources.remove(dataSource3); // remove old data


    //   // Then load the data again
    //   var dataSource3 = Cesium.GeoJsonDataSource.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/model/location/4326').then(
    //     function(dataSource3) {
    //       var p = dataSource3.entities.values;
    //       for (var i = 0; i < p.length; i++) { 
    //         if (p[i].properties.height > 0) { // make sure extrude something when it has height otherwise it would crash 
    //           p[i].polygon.extrudedHeight = p[i].properties.height; //extrude using the "height" in geojson file  
    //         }          
    //       }
    //       //dataSource3.material = Cesium.Color.GREEN; // Test code to change the colour
    //       viewer.dataSources.add(dataSource3, {
    //         stroke: Cesium.Color.RED,
    //         fill: Cesium.Color.RED,
    //         strokeWidth: 3
    //       });
    //       viewer.zoomTo(dataSource3);
    //     }
    //   )
    // }

    // Original code COPY
    // function refresh2D84Model() {
    //   viewer.dataSources.remove(dataSource2); // remove old data


    //   // Then load the data again
    //   var dataSource2 = Cesium.GeoJsonDataSource.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/model/location_2d/4326').then(
    //     function(dataSource2) {
    //       var p = dataSource2.entities.values;
    //       for (var i = 0; i < p.length; i++) { 
    //         if (p[i].properties.height > 0) { // make sure extrude something when it has height otherwise it would crash 
    //           p[i].polygon.extrudedHeight = p[i].properties.height; //extrude using the "height" in geojson file  
    //         }          
    //       }
    //       dataSource2.material = Cesium.Color.GREEN; // Test code to change the colour, didn't work so far
    //       viewer.dataSources.add(dataSource2);
    //       viewer.zoomTo(dataSource2);
    //     }
    //   )
    // }

    function getOSModel() {
      viewer.dataSources.remove(dataSource2); // remove old data


      // Then load the data again
      document.getElementById("working_layer").innerHTML = buildings_tq2580f;  
      var dataSource2 = Cesium.GeoJsonDataSource.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/buildings_tq2580/geom/4326').then(
        function(dataSource2) {
          var p = dataSource2.entities.values;
          for (var i = 0; i < p.length; i++) { 
            if (p[i].properties.height > 0) { // make sure extrude something when it has height otherwise it would crash 
              p[i].polygon.extrudedHeight = p[i].properties.height; //extrude using the "height" in geojson file  
            }          
          }
          dataSource2.material = Cesium.Color.GREEN; // Test code to change the colour, didn't work so far
          viewer.dataSources.add(dataSource2);
          viewer.zoomTo(dataSource2);
        }
      )
    }


    // function getOSModel(feature,i){
    //   var tileset = viewer.scene.primitives.add(new Cesium.Cesium3DTileset({
    //   url : 'http://developer.cege.ucl.ac.uk/home/studentuser/code/cesium-app/buildings_tq2580/tileset.json'
    //               }));
 
    //   var style = new Cesium.Cesium3DTileStyle();
    //   // Override color expression with a string
    //   var featureColour = 'color("'+feature.properties.layer_colour+'",'+feature.properties.layer_transparency+')';
    //   console.log(featureColour);
    //   style.color = featureColour;
    //   style.pointSize = Cesium.defaultValue(style.pointSize, 5.0);
    //   tileset[i].style = style;
    //     tileset[i].readyPromise.then(function(onetileset) {
    //        var heightOffset = 0.0;
    //        onetileset.pointCloudShading.attenuation = true

    //   var boundingSphere = onetileset.boundingSphere;
    //   var cartographic = Cesium.Cartographic.fromCartesian(boundingSphere.center);
    //   var surface = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, 0.0);
    //   var offset = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, heightOffset);
    //   var translation = Cesium.Cartesian3.subtract(offset, surface, new Cesium.Cartesian3());
    //   onetileset.modelMatrix = Cesium.Matrix4.fromTranslation(translation);
    //   /*    viewer.camera.viewBoundingSphere(onetileset.boundingSphere, new Cesium.HeadingPitchRange(0, -0.5, 0)); */
    //     });         
    // }


    // Original code COPY
    function refresh84Model() {
      if (viewer.dataSources.contains(dataSource3)) {
        viewer.remove(dataSource3); // remove old data
        alert("refreshing");
      }
      alert("T/F: " + viewer.dataSources.contains(dataSource3));
      // Then load the data again
      document.getElementById("working_layer").innerHTML = "model"; 

      var dataSource3 = Cesium.GeoJsonDataSource.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/model/geom/4326').then(
        function(dataSource3) {
          var p = dataSource3.entities.values;
          for (var i = 0; i < p.length; i++) { 
            if (p[i].properties.height > 0) { // make sure extrude something when it has height otherwise it would crash 
              p[i].polygon.extrudedHeight = p[i].properties.height; //extrude using the "height" in geojson file  
            }          
          }
          dataSource3.material = Cesium.Color.GREEN; // Test code to change the colour
          console.log("before",viewer.dataSources.contains(dataSource3));
          viewer.dataSources.add(dataSource3);
          if (viewer.dataSources.contains(dataSource3)) {
              alert("loaded 3");
              viewer.zoomTo(dataSource3);
          }
          console.log("after:",viewer.dataSources.contains(dataSource3));
          //viewer.zoomTo(dataSource3); //COPY
        }
      )
      alert("i m here");
      alert("outside function:" + viewer.dataSources.contains(dataSource3));
    }


    // function to load/refresh buffer of WGS84 geometry layer
    function refresh84ModelBuffer() {
      viewer.dataSources.remove(dataSource4); // remove old data


      // Then load the data again
      var dataSource4 = Cesium.GeoJsonDataSource.load('').then(
        function(dataSource4) {
          viewer.dataSources.add(dataSource4);
          viewer.zoomTo(dataSource4);
        }
      )
    }



    // function to load/refresh National Grid geometry layer
    function refreshGBModel() {
      // THIS IS THE TEST CODE TO REMOVE DATASOURCE3
      viewer.dataSources.remove(dataSource5); // remove old data

      // Then load the data again
      var dataSource5 = Cesium.GeoJsonDataSource.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/model/location_27700/4326').then(
        function(dataSource5) {
          var p = dataSource5.entities.values;
          for (var i = 0; i < p.length; i++) { 
            if (p[i].properties.height > 0) { // make sure extrude something when it has height otherwise it would crash 
              p[i].polygon.extrudedHeight = p[i].properties.height; //extrude using the "height" in geojson file  
            }          
          }
          viewer.dataSources.add(dataSource5);
          viewer.zoomTo(dataSource5);
        }
      )
    }



    // function to load/refresh National Grid geometry layer
    function refreshGBModelBuffer() {
      alert(document.getElementById("working_layer").innerHTML);
    }







    // Remove all the data
    function removeModels(){
      console.log("try to remove:",viewer.dataSources.contains(dataSource3));
      viewer.dataSources.remove(dataSource3);
    }








    // tabs to change the input geometry type
    // Adapted from: https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_tabs_open[Accessed on 13 August, 2020]
    function openGeom(evt, geomName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(geomName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    // Get the element with id="defaultOpen" and click on it
    document.getElementById("defaultOpen").click();







    // TEST CODE TO TOGGLE LAYERS
    // Create a typical CzmlDataSource.
    // var dataSource7 = new Cesium.DataSource();
    // dataSource7.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/model/location/4326');

    // // Add a checkbox at the top.
    // // document.getElementById('skyCheckbox').innerHTML =
    // //     '<label><input type="checkbox" id="showCheckbox" /> Show CZML</label>';

    // var checkbox = document.getElementById('showCheckbox');
    // checkbox.addEventListener('change', function() {
    //     // Checkbox state changed.
    //     if (checkbox.checked) {
    //         // Show if not shown.
    //         if (!viewer.dataSources.contains(dataSource7)) {
    //             viewer.dataSources.add(dataSource7);
    //         }
    //     } else {
    //         // Hide if currently shown.
    //         if (viewer.dataSources.contains(dataSource7)) {
    //             viewer.dataSources.remove(dataSource7);
    //         }
    //     }
    // }, false);

    // var dataSource1 = new Cesium.CzmlDataSource();
    //dataSource1.load('../../SampleData/simple.czml');

    
    // var dataSource7;

    // // Add a checkbox at the top.
    // document.getElementById('toolbar').innerHTML =
    //     '<label><input type="checkbox" id="showCheckbox" /> Show 84</label>';

    // var checkbox = document.getElementById('showCheckbox');
    // checkbox.addEventListener('change', function() {

    //     // Checkbox state changed.
    //     if (checkbox.checked) {
    //       var dataSource7 = Cesium.GeoJsonDataSource.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/model/location/4326').then(
    //         function(dataSource7) {
    //           viewer.dataSources.add(dataSource7);
    //           console.log("IF 7 WAS added: ",viewer.dataSources.contains(dataSource7));
    //           viewer.zoomTo(dataSource7);
    //         }
    //       )    
    //     } else if(!checkbox.checked){
    //         alert('Checkbox has been unticked!');
    //         console.log("IF 7 is still: ",viewer.dataSources.contains(dataSource7));
    //         // Hide if currently shown.
    //         if (viewer.dataSources.contains(dataSource7)) {
    //             alert("got 7");
    //             viewer.dataSources.remove(dataSource7)
    //             console.log("IF 7 WAS removed: ",viewer.dataSources.contains(dataSource7)); 
    //         }
    //     }
    // }, false);




    // CODE TO TOGGLE LAYERS
    // Adapted from: https://stackoverflow.com/questions/29184613/how-can-you-control-visibility-of-datasource-in-cesiumjs [Accessed on 12 August, 2020]

    // TO LOAD DATA FROM MODEL LAYER
    var dataSource7 = new Cesium.GeoJsonDataSource();
    dataSource7.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/models/geom/4326');

    // TOGGLE MODEL LAYER
    var checkboxModel = document.getElementById('Checkbox_model');
    checkboxModel.addEventListener('change', function() {

        // Checkbox state changed.
        if (checkboxModel.checked) {
          // Show if not shown.
          if (!viewer.dataSources.contains(dataSource7)) {
              viewer.dataSources.add(dataSource7);
              viewer.zoomTo(dataSource7);
              document.getElementById("working_layer").innerHTML = "models"; // add table name
          }
        } else {
            viewer.dataSources.remove(dataSource7);
            document.getElementById("working_layer").innerHTML = ""; // remove table name
        }
    }, false);


    // TO LOAD DATA FROM OS LAYER
    var dataSource8 = new Cesium.GeoJsonDataSource();
    dataSource8.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/buildings_tq2580/geom/4326');

    // TO TOGGLE OS LAYER
    var checkboxOS = document.getElementById('Checkbox_OS');
    checkboxOS.addEventListener('change', function() {

        // Checkbox state changed.
        if (checkboxOS.checked) {
          // Show if not shown.
          if (!viewer.dataSources.contains(dataSource8)) {
              viewer.dataSources.add(dataSource8);
              viewer.zoomTo(dataSource8);
              document.getElementById("working_layer").innerHTML = "buildings_tq2580"; // add table name
          }
        } else {
            viewer.dataSources.remove(dataSource8);
            document.getElementById("working_layer").innerHTML = ""; // remove table name
        }
    }, false);




    // TO LOAD DATA FROM MODEL-BUFFER LAYER
    var dataSource9 = new Cesium.GeoJsonDataSource();
    dataSource9.load('https://developer.cege.ucl.ac.uk:30281/getGeoJSON/models/buffer/4326');

    // TOGGLE MODEL LAYER
    var checkboxModelBuffer = document.getElementById('Checkbox_model_buffer');
    checkboxModelBuffer.addEventListener('change', function() {

        // Checkbox state changed.
        if (checkboxModelBuffer.checked) {
          // Show if not shown.
          if (!viewer.dataSources.contains(dataSource9)) {
              viewer.dataSources.add(dataSource9);
              viewer.zoomTo(dataSource9);
              document.getElementById("working_layer").innerHTML = "models"; // add table name
          }
        } else {
            viewer.dataSources.remove(dataSource9);
            document.getElementById("working_layer").innerHTML = ""; // remove table name
        }
    }, false);





    // The function to show cursor latlng

    // adapted from: https://stackoverflow.com/questions/52342073/i-want-to-get-latitude-longitude-height-of-my-mouse-at-the-bottom-of-the-cesium
    // viewer.scene.canvas.addEventListener('mousemove', function(e) {
    //     var entity = viewer.entities.getById('mou');
    //     var ellipsoid = viewer.scene.globe.ellipsoid;
    //     // Mouse over the globe to see the cartographic position 
    //     var cartesian = viewer.camera.pickEllipsoid(new Cesium.Cartesian3(e.clientX, e.clientY), ellipsoid);
    //     if (cartesian) {
    //         var cartographic = ellipsoid.cartesianToCartographic(cartesian);
    //         var longitudeString = Cesium.Math.toDegrees(cartographic.longitude).toFixed(10);
    //         var latitudeString = Cesium.Math.toDegrees(cartographic.latitude).toFixed(10);
    //         entity.position = cartesian;
    //         entity.label.show = true;
    //         entity.label.font_style = 84;
    //         //entity.position= Cesium.Cartesian2.ZERO; 
    //         entity.label.text = '(' + longitudeString + ', ' + latitudeString + ')';
    //         var result = entity.label.text; // we can reuse this
    //         // document.getElementById("demo").innerHTML = entity.label.text;
    //     } else {
    //         entity.label.show = false;
    //     }
    // });


    // The function to get latlng when click on map
    // Adapted from: http://www.phpmind.com/blog/2015/11/cesiumjs-how-to-get-longitude-and-latitude-on-click/ [Accessed: 24 Jun, 2020]
    // Adapted from: https://groups.google.com/forum/#!topic/cesium-dev/kDIs_j9zKNI [Accessed: 30 Jun, 2020]
    viewer.canvas.addEventListener('click', function(e){
      var mousePosition = new Cesium.Cartesian3(e.clientX, e.clientY, e.clientZ);
   
      var ellipsoid = viewer.scene.globe.ellipsoid;
      var cartesian = viewer.camera.pickEllipsoid(mousePosition, ellipsoid);
      
      if (cartesian) {
          var cartographic = ellipsoid.cartesianToCartographic(cartesian);
          var cartographic = Cesium.Ellipsoid.WGS84.cartesianToCartographic(cartesian); // this also works
          var longitudeString = Cesium.Math.toDegrees(cartographic.longitude).toFixed(8);
          var latitudeString = Cesium.Math.toDegrees(cartographic.latitude).toFixed(8);
          //var altitudeString = Cesium.Math.toDegrees(cartographic.height).toFixed(10);
          var altitudeString = cartographic.height.toFixed(5); // The unit for height is metre, so no need to convert to degrees
   
          //alert(longitudeString + ', ' + latitudeString + ', ' + altitudeString);
          // These are for the coords in 
          document.getElementById("latitude").value = latitudeString;
          document.getElementById("longitude").value = longitudeString;
          document.getElementById("altitude").value = altitudeString;

          // These are for the coords in "EDIT Point Location" form
          // document.getElementById("latitude_edit").value = latitudeString;
          // document.getElementById("longitude_edit").value = longitudeString;
          // document.getElementById("altitude_edit").value = altitudeString;
      } else {
          alert('Globe was not picked');
      }  
    }, false);








    // Track mouse click coordinates
    // Adapted from: https://stackoverflow.com/questions/36925075/save-mouse-coordinate-in-an-array [Accessed on 6 July, 2020]
    // Need this to track clicks
    viewer.canvas.addEventListener('click', handleClick, false);



















    






    // test to draw geometry dynamically
    // It worked, but there is offset of the cursor location and the point created
 
    // Adapt from: https://sandcastle.cesium.com/?src=Drawing%20on%20Terrain.html [Accessed on 3 August, 2020]

    // viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(
    //   Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK
    // );
    // function createPoint(worldPosition) {
    //   var point = viewer.entities.add({
    //     position: worldPosition,
    //     point: {
    //       color: Cesium.Color.WHITE,
    //       pixelSize: 5,
    //       heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
    //     },
    //   });
    //   return point;
    // }
    // var drawingMode = "polygon";

    // function drawShape(positionData) {
    //   var shape;
    //   if (drawingMode === "line") {
    //     shape = viewer.entities.add({
    //       polyline: {
    //         positions: positionData,
    //         clampToGround: true,
    //         width: 3,
    //       },
    //     });
    //   } else if (drawingMode === "polygon") {
    //     shape = viewer.entities.add({
    //       polygon: {
    //         hierarchy: positionData,
    //         material: new Cesium.ColorMaterialProperty(
    //           Cesium.Color.WHITE.withAlpha(0.7)
    //         ),
    //       },
    //     });
    //   }
    //   return shape;
    // }

    // var activeShapePoints = [];
    // var activeShape;
    // var floatingPoint;
    // var handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas);
    // handler.setInputAction(function (event) {
    //   // We use `viewer.scene.pickPosition` here instead of `viewer.camera.pickEllipsoid` so that
    //   // we get the correct point when mousing over terrain.
    //   var earthPosition = viewer.scene.pickPosition(event.position);
    //   // `earthPosition` will be undefined if our mouse is not over the globe.
    //   if (Cesium.defined(earthPosition)) {
    //     if (activeShapePoints.length === 0) {
    //       floatingPoint = createPoint(earthPosition);
    //       activeShapePoints.push(earthPosition);
    //       var dynamicPositions = new Cesium.CallbackProperty(function () {
    //         if (drawingMode === "polygon") {
    //           return new Cesium.PolygonHierarchy(activeShapePoints);
    //         }
    //         return activeShapePoints;
    //       }, false);
    //       activeShape = drawShape(dynamicPositions);
    //     }
    //     activeShapePoints.push(earthPosition);
    //     createPoint(earthPosition);
    //   }
    // }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

    // handler.setInputAction(function (event) {
    //   if (Cesium.defined(floatingPoint)) {
    //     var newPosition = viewer.scene.pickPosition(event.endPosition);
    //     if (Cesium.defined(newPosition)) {
    //       floatingPoint.position.setValue(newPosition);
    //       activeShapePoints.pop();
    //       activeShapePoints.push(newPosition);
    //     }
    //   }
    // }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
    // // Redraw the shape so it's not dynamic and remove the dynamic shape.
    // function terminateShape() {
    //   activeShapePoints.pop();
    //   drawShape(activeShapePoints);
    //   viewer.entities.remove(floatingPoint);
    //   viewer.entities.remove(activeShape);
    //   floatingPoint = undefined;
    //   activeShape = undefined;
    //   activeShapePoints = [];
    // }
    // handler.setInputAction(function (event) {
    //   terminateShape();
    // }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);





    

    // var viewer = new Cesium.Viewer('cesiumContainer');
    // function to zoom to user location
    
    // from: https://groups.google.com/forum/#!topic/cesium-dev/VDaXd0oODhs
    // function fly(position) {
    //     var source = new Cesium.CustomDataSource();
    //     viewer.dataSources.add(source);
    //     var entity = source.entities.add({
    //         position : Cesium.Cartesian3.fromDegrees(position.coords.longitude, position.coords.latitude),
    //         ellipse : {
    //             semiMajorAxis : 100.0,
    //             semiMinorAxis : 100.0,
    //             material : new Cesium.ColorMaterialProperty(new Cesium.Color(0.2, 0.2, 1.0, 0.5))
    //         },

    //         // Can't load images for some reasons
    //         // billboard : {
    //         //     image : '../Cesium Code/image/pin.png',
    //         //     imageSubRegion : new Cesium.BoundingRectangle(49, 43, 18, 18),
    //         //     color : Cesium.Color.LIME
    //         // },

    //         // This worked but is at the bottom of the ellipse
    //         label : {
    //             text: 'You are here',
    //             verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
    //             show: false
    //         }
    //     });

    //     function showLabel() {
    //         entity.label.show = true;
    //     }

    //     viewer.camera.flyTo({
    //         destination : Cesium.Cartesian3.fromDegrees(position.coords.longitude, position.coords.latitude, 1005.0),
    //         complete: showLabel
    //     });
    // }
    // // Ask browser for location, and fly there.
    // navigator.geolocation.getCurrentPosition(fly);



    // //load Cesium map and then add the data AFTER the page has loaded
    document.addEventListener('DOMContentLoaded', function() { 
      loadMap(); 
    }, false); 

    // get port number
    function loadMap() { 
      getPorts(); 
    } 


</script>

</html>
